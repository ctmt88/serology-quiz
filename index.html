<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è¡€æ¸…å…ç–«é¡Œåº« - è‡ªè¨‚ç·´ç¿’</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Microsoft JhengHei', 'å¾®è»Ÿæ­£é»‘é«”', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }
        
        .container {
            background: white;
            border-radius: 20px;
            padding: 40px;
            max-width: 600px;
            width: 100%;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        }
        
        h1 {
            color: #667eea;
            text-align: center;
            margin-bottom: 10px;
            font-size: 2rem;
        }
        
        .subtitle {
            text-align: center;
            color: #666;
            margin-bottom: 30px;
            font-size: 0.9rem;
        }
        
        .option-group {
            margin-bottom: 25px;
        }
        
        .option-group label {
            display: block;
            font-weight: bold;
            color: #333;
            margin-bottom: 10px;
            font-size: 1.1rem;
        }
        
        .option-group input[type="number"] {
            width: 100%;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 10px;
            font-size: 1rem;
            transition: border-color 0.3s;
        }
        
        .option-group input[type="number"]:focus {
            outline: none;
            border-color: #667eea;
        }
        
        .quick-select {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin-top: 10px;
        }
        
        .quick-btn {
            flex: 1;
            min-width: 60px;
            padding: 10px;
            background: #f0f0f0;
            border: 2px solid #ddd;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 0.95rem;
            font-weight: 500;
        }
        
        .quick-btn:hover {
            background: #667eea;
            color: white;
            border-color: #667eea;
        }
        
        .category-select {
            margin-bottom: 25px;
        }
        
        .category-select label {
            display: block;
            font-weight: bold;
            color: #333;
            margin-bottom: 10px;
        }
        
        .category-options {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 10px;
        }
        
        .category-checkbox {
            display: flex;
            align-items: center;
            padding: 8px;
            background: #f8f9fa;
            border-radius: 8px;
            cursor: pointer;
            transition: background 0.3s;
        }
        
        .category-checkbox:hover {
            background: #e9ecef;
        }
        
        .category-checkbox input[type="checkbox"] {
            margin-right: 8px;
            width: 18px;
            height: 18px;
            cursor: pointer;
        }
        
        .start-btn {
            width: 100%;
            padding: 15px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 12px;
            font-size: 1.3rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            margin-top: 20px;
        }
        
        .start-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 30px rgba(102, 126, 234, 0.4);
        }
        
        .start-btn:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
        }
        
        .info-box {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 10px;
            margin-top: 20px;
            border-left: 4px solid #667eea;
        }
        
        .info-box h3 {
            color: #667eea;
            margin-bottom: 10px;
            font-size: 1.1rem;
        }
        
        .info-box p {
            color: #666;
            line-height: 1.6;
            margin-bottom: 8px;
        }
        
        .loading {
            text-align: center;
            color: #667eea;
            padding: 20px;
        }
        
        .error {
            background: #fee;
            color: #c00;
            padding: 15px;
            border-radius: 10px;
            margin-top: 20px;
            border-left: 4px solid #c00;
        }
        
        .visitor-counter {
            text-align: center;
            padding: 15px;
            margin-top: 20px;
            background: linear-gradient(135deg, #667eea15 0%, #764ba215 100%);
            border-radius: 10px;
            font-size: 0.95rem;
            color: #666;
        }
        
        .visitor-counter img {
            vertical-align: middle;
            margin-left: 8px;
            height: 20px;
        }
        
        /* ========== éŸ¿æ‡‰å¼è¨­è¨ˆ (RWD) ========== */
        
        /* å¹³æ¿ (768px ä»¥ä¸‹) */
        @media (max-width: 768px) {
            .container {
                padding: 30px 20px;
                max-width: 100%;
            }
            
            h1 {
                font-size: 1.6rem;
                margin-bottom: 8px;
            }
            
            .subtitle {
                font-size: 0.85rem;
                margin-bottom: 25px;
            }
            
            .option-group label {
                font-size: 1rem;
            }
            
            .option-group input[type="number"] {
                padding: 10px;
                font-size: 0.95rem;
            }
            
            .quick-select {
                gap: 8px;
            }
            
            .quick-btn {
                padding: 8px;
                font-size: 0.9rem;
                min-width: 50px;
            }
            
            .category-options {
                grid-template-columns: repeat(auto-fill, minmax(130px, 1fr));
                gap: 8px;
            }
            
            .start-btn {
                padding: 12px;
                font-size: 1.1rem;
            }
            
            .info-box {
                padding: 12px;
            }
            
            .info-box h3 {
                font-size: 1rem;
            }
            
            .info-box p {
                font-size: 0.9rem;
            }
        }
        
        /* æ‰‹æ©Ÿ (480px ä»¥ä¸‹) */
        @media (max-width: 480px) {
            body {
                padding: 10px;
            }
            
            .container {
                padding: 25px 15px;
                border-radius: 15px;
            }
            
            h1 {
                font-size: 1.4rem;
                margin-bottom: 6px;
            }
            
            .subtitle {
                font-size: 0.8rem;
                margin-bottom: 20px;
            }
            
            .option-group {
                margin-bottom: 20px;
            }
            
            .option-group label {
                font-size: 0.95rem;
                margin-bottom: 8px;
            }
            
            .option-group input[type="number"] {
                padding: 10px;
                font-size: 0.9rem;
            }
            
            .quick-select {
                gap: 6px;
            }
            
            .quick-btn {
                padding: 8px 6px;
                font-size: 0.85rem;
                min-width: 45px;
                flex: 1;
            }
            
            .category-select label {
                font-size: 0.95rem;
            }
            
            .category-options {
                grid-template-columns: 1fr 1fr;
                gap: 6px;
            }
            
            .category-checkbox {
                padding: 6px;
                font-size: 0.85rem;
            }
            
            .category-checkbox input[type="checkbox"] {
                width: 16px;
                height: 16px;
                margin-right: 6px;
            }
            
            .start-btn {
                padding: 12px;
                font-size: 1rem;
                margin-top: 15px;
            }
            
            .info-box {
                padding: 12px;
                margin-top: 15px;
            }
            
            .info-box h3 {
                font-size: 0.95rem;
                margin-bottom: 8px;
            }
            
            .info-box p {
                font-size: 0.85rem;
                margin-bottom: 6px;
                line-height: 1.5;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ§ª è¡€æ¸…å…ç–«é¡Œåº«</h1>
        <div class="subtitle">è‡ªè¨‚ç·´ç¿’è¨­å®š</div>
        
        <!-- çµ±è¨ˆé¢æ¿ -->
        <div class="stats-panel">
            <div class="stat-item">
                <div class="stat-number" id="visit-count">0</div>
                <div class="stat-label">è¨ªå•æ¬¡æ•¸</div>
            </div>
            <div class="stat-item">
                <div class="stat-number" id="practice-count">0</div>
                <div class="stat-label">ç·´ç¿’æ¬¡æ•¸</div>
            </div>
            <div class="stat-item">
                <div class="stat-number" id="total-questions">0</div>
                <div class="stat-label">ç´¯è¨ˆé¡Œæ•¸</div>
            </div>
        </div>
        
        <div id="loading" class="loading">
            <p>â³ è¼‰å…¥é¡Œåº«è³‡æ–™ä¸­...</p>
        </div>
        
        <div id="error" class="error" style="display: none;"></div>
        
        <div id="settings" style="display: none;">
            <div class="option-group">
                <label for="question-count">é¸æ“‡é¡Œæ•¸ï¼š</label>
                <input type="number" id="question-count" min="1" max="160" value="20">
                <div class="quick-select">
                    <button class="quick-btn" onclick="setCount(10)">10é¡Œ</button>
                    <button class="quick-btn" onclick="setCount(20)">20é¡Œ</button>
                    <button class="quick-btn" onclick="setCount(30)">30é¡Œ</button>
                    <button class="quick-btn" onclick="setCount(50)">50é¡Œ</button>
                    <button class="quick-btn" onclick="setCount(160)">å…¨éƒ¨</button>
                </div>
            </div>
            
            <div class="category-select">
                <label>
                    <input type="checkbox" id="select-all-categories" checked onchange="toggleAllCategories()">
                    é¸æ“‡é¡åˆ¥ï¼ˆå…¨é¸ï¼‰
                </label>
                <div class="category-options" id="category-options">
                    <!-- å‹•æ…‹è¼‰å…¥é¡åˆ¥ -->
                </div>
            </div>
            
            <button class="start-btn" onclick="startQuiz()">é–‹å§‹ç·´ç¿’ ğŸš€</button>
            
            <div class="info-box">
                <h3>ğŸ’¡ ä½¿ç”¨èªªæ˜</h3>
                <p>ğŸ“Š é¡Œåº«ç¸½æ•¸ï¼š<span id="total-count">160</span> é¡Œ</p>
                <p>ğŸ² é¡Œç›®é †åºï¼šéš¨æ©Ÿæ’åˆ—</p>
                <p>ğŸ¯ é¸é …é †åºï¼šéš¨æ©Ÿæ’åˆ—</p>
                <p>ğŸ“š åŒ…å«è©³è§£ï¼šå®Œæ•´èªªæ˜</p>
            </div>
            
            <div class="visitor-counter">
                ğŸ‘ï¸ ç¶²é ç€è¦½æ¬¡æ•¸ï¼š<span id="visit-counter-display" style="font-weight: bold; color: #667eea;">567</span> æ¬¡
            </div>
        </div>
    </div>
    
    <!-- SQL.js CDN -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/sql.js/1.8.0/sql-wasm.js"></script>
    
    <script>
        let db = null;
        let allCategories = [];
        
        // è¼‰å…¥è³‡æ–™åº«
        async function loadDatabase() {
            try {
                const SQL = await initSqlJs({
                    locateFile: file => `https://cdnjs.cloudflare.com/ajax/libs/sql.js/1.8.0/${file}`
                });
                
                const response = await fetch('data/questions.db');
                const buffer = await response.arrayBuffer();
                db = new SQL.Database(new Uint8Array(buffer));
                
                document.getElementById('loading').style.display = 'none';
                document.getElementById('settings').style.display = 'block';
                
                loadCategories();
                updateTotalCount();
            } catch (error) {
                document.getElementById('loading').style.display = 'none';
                document.getElementById('error').style.display = 'block';
                document.getElementById('error').textContent = 'è¼‰å…¥å¤±æ•—ï¼š' + error.message;
            }
        }
        
        // è¼‰å…¥é¡åˆ¥
        function loadCategories() {
            const result = db.exec('SELECT DISTINCT category FROM questions WHERE category IS NOT NULL ORDER BY category');
            
            if (result.length > 0) {
                allCategories = result[0].values.map(row => row[0]);
                
                const container = document.getElementById('category-options');
                container.innerHTML = allCategories.map(cat => `
                    <label class="category-checkbox">
                        <input type="checkbox" class="category-check" value="${cat}" checked>
                        <span>${cat}</span>
                    </label>
                `).join('');
            }
        }
        
        // æ›´æ–°é¡Œæ•¸
        function updateTotalCount() {
            const result = db.exec('SELECT COUNT(*) FROM questions');
            if (result.length > 0) {
                const count = result[0].values[0][0];
                document.getElementById('total-count').textContent = count;
                document.getElementById('question-count').max = count;
            }
        }
        
        // è¨­å®šé¡Œæ•¸
        function setCount(count) {
            document.getElementById('question-count').value = count;
        }
        
        // å…¨é¸/å–æ¶ˆå…¨é¸é¡åˆ¥
        function toggleAllCategories() {
            const checked = document.getElementById('select-all-categories').checked;
            document.querySelectorAll('.category-check').forEach(cb => {
                cb.checked = checked;
            });
        }
        
        // é–‹å§‹æ¸¬é©—
        function startQuiz() {
            const count = parseInt(document.getElementById('question-count').value);
            const selectedCategories = Array.from(document.querySelectorAll('.category-check:checked'))
                .map(cb => cb.value);
            
            if (selectedCategories.length === 0) {
                alert('è«‹è‡³å°‘é¸æ“‡ä¸€å€‹é¡åˆ¥ï¼');
                return;
            }
            
            // å„²å­˜è¨­å®šåˆ° localStorage
            localStorage.setItem('quizSettings', JSON.stringify({
                count: count,
                categories: selectedCategories
            }));
            
            // è·³è½‰åˆ°ç­”é¡Œé é¢
            window.location.href = 'quiz.html';
        }
        
        // é é¢è¼‰å…¥æ™‚åŸ·è¡Œ
        window.addEventListener('DOMContentLoaded', function() {
            loadDatabase();
            updateVisitCounter();
        });
        
        // è¨ªå•è¨ˆæ•¸å™¨
        function updateVisitCounter() {
            const INITIAL_COUNT = 567; // èµ·å§‹å€¼
            const STORAGE_KEY = 'pageVisitCount';
            
            // å¾ localStorage è®€å–æˆ–åˆå§‹åŒ–è¨ˆæ•¸
            let visitCount = localStorage.getItem(STORAGE_KEY);
            
            if (!visitCount) {
                visitCount = INITIAL_COUNT;
            } else {
                visitCount = parseInt(visitCount);
            }
            
            // å¢åŠ è¨ˆæ•¸
            visitCount++;
            
            // ä¿å­˜åˆ° localStorage
            localStorage.setItem(STORAGE_KEY, visitCount);
            
            // é¡¯ç¤ºè¨ˆæ•¸ï¼ˆæ·»åŠ æ•¸å­—å‹•ç•«æ•ˆæœï¼‰
            const counterDisplay = document.getElementById('visit-counter-display');
            if (counterDisplay) {
                animateCounter(counterDisplay, visitCount);
            }
        }
        
        // æ•¸å­—å‹•ç•«æ•ˆæœ
        function animateCounter(element, targetValue) {
            const duration = 1000; // 1ç§’å‹•ç•«
            const startValue = Math.max(567, targetValue - 10);
            const startTime = performance.now();
            
            function update(currentTime) {
                const elapsed = currentTime - startTime;
                const progress = Math.min(elapsed / duration, 1);
                
                const currentValue = Math.floor(startValue + (targetValue - startValue) * progress);
                element.textContent = currentValue.toLocaleString();
                
                if (progress < 1) {
                    requestAnimationFrame(update);
                }
            }
            
            requestAnimationFrame(update);
        }
    </script>
</body>
</html>
